[![IPS-Version](https://img.shields.io/badge/Symcon_Version-6.0+-red.svg)](https://www.symcon.de/service/dokumentation/entwicklerbereich/sdk-tools/sdk-php/)
![Code](https://img.shields.io/badge/Code-PHP-blue.svg)
[![License](https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-green.svg)](https://creativecommons.org/licenses/by-nc-sa/4.0/)

## Dokumentation

**Inhaltsverzeichnis**

1. [Funktionsumfang](#1-funktionsumfang)
2. [Voraussetzungen](#2-voraussetzungen)
3. [Installation](#3-installation)
4. [Funktionsreferenz](#4-funktionsreferenz)
5. [Konfiguration](#5-konfiguration)
6. [Anhang](#6-anhang)
7. [Versions-Historie](#7-versions-historie)

## 1. Funktionsumfang

Steuerung der Panasonic-Geräte die in der Panasonic Comfort Cloud angemeldet sind, unterstützt wird zur Zeit:<br>
- Klimageräte
- Aquarea Wärmepumpen

## 2. Voraussetzungen

- IP-Symcon ab Version 6.0
- Account in der Panasonic Comfort Cloud zur Steuerung angemeldeter Klimageräte bzw. zusätzlich in der Aquarea Smart Cloud für dort registrierte Wärmepumpen

## 3. Installation

### a. Installation des Moduls

Im [Module Store](https://www.symcon.de/service/dokumentation/komponenten/verwaltungskonsole/module-store/) ist das Modul unter dem Suchbegriff *Panasonic ComfortCloud* zu finden.<br>
Alternativ kann das Modul über [Module Control](https://www.symcon.de/service/dokumentation/modulreferenz/module-control/) unter Angabe der URL `https://github.com/demel42/IPSymconPanasonicComfortCloud.git` installiert werden.

### b. Einrichtung in IPS

#### Panasonic Comfort Cloud I/O
In IP-Symcon nun unterhalb von _I/O Instanzen_ die Funktion _Instanz hinzufügen_ auswählen und als Hersteller _Panasonic_ angeben.
Benutzerkennung und Passwort der PanasonicCloud angeben.

#### Panasonic Comfort Cloud Konfigurator
In IP-Symcon nun unterhalb von _Konfigurator Instanzen_ die Funktion _Instanz hinzufügen_ auswählen und als Hersteller _Panasonic_ angeben.
In dem Konfigurator werden nun alle eingerichteten Gruppen mit den Geräten aufgelistet; eine Anlage der Geräte-Instanz kann entsprechend erfolgen

#### Panasonic Comfort Cloud Gerät
Die Geräte-Instanz wird über dem Konfigurator angelegt. In der _Basis-Konfiguration_ ist Geräte-ID, Modell sowie der Produkt-Typ eingetragen.

#### Panasonic Comfort Cloud Aquarea Gerät
Die Geräte-Instanz wird über dem Konfigurator angelegt. In der _Basis-Konfiguration_ ist Geräte-ID, Modell sowie der Produkt-Typ eingetragen.

## 4. Funktionsreferenz

alle Funktionen sind über _RequestAction_ der jew. Variablen ansteuerbar

## 5. Konfiguration

### Panasonic Comfort Cloud I/O

| Eigenschaft               | Typ      | Standardwert | Beschreibung |
| :------------------------ | :------  | :----------- | :----------- |
| Instanz deaktivieren      | boolean  | false        | Instanz temporär deaktivieren |
|                           |          |              | |
| Benutzerkennung           | string   |              | Kennung der Panaonic Confort Cloud |
| Kennwort                  | string   |              | Passwort der Panaonic Confort Cloud |

#### Aktionen

| Bezeichnung                | Beschreibung |
| :------------------------- | :----------- |
| Zugriff testen             | Test der Zugangsdaten und Ausgabe der in der Cloud vorhandenen Geräte |


### Panasonic Comfort Cloud Konfigurator

| Eigenschaft               | Typ     | Standardwert | Beschreibung |
| :------------------------ | :------ | :----------- | :----------- |
| Kategorie                 | integer | 0            | Kategorie zu Anlage von Instanzen _[1]_ |

_[1]_: nur bis IPS-Version 7 vorhanden, danach ist eine Einstellmöglichkeit Bestandteil des Standard-Konfigurators

### Panasonic Comfort Cloud Gerät

#### Properties

| Eigenschaft               | Typ     | Standardwert | Beschreibung |
| :------------------------ | :------ | :----------- | :----------- |
| Instanz deaktivieren      | boolean | false        | Instanz temporär deaktivieren |
|                           |         |              | |
| Geräte-ID                 | string  |              | |
| Modell                    | string  |              | |
| Typ                       | integer | 3            | 3=Klimagerät |
|                           |         |              | |
| Luftstromrichtungswechsel | integer | 0            | Richtung des Wechsels (0=nur vertikal, 1=vertikal und horizontal) |
| hat nanoe X-Technologie   | boolean |              | Gerät verfügt über die Technik zur Luftreinigung |
|                           |         |              | |
| Aktualisierungsintervall  | integer | 60           | іn Sekunden |

#### Aktionen

| Bezeichnung                | Beschreibung |
| :------------------------- | :----------- |
| Daten aktualisieren        | Datenabruf aus der Panasonic Comfort Cloud |

### Variablenprofile

Es werden folgende Variablenprofile angelegt:
* Boolean<br>
PanasonicCloud.Operate

* Integer<br>
PanasonicCloud.AirflowHorizontal,
PanasonicCloud.AirflowVertical,
PanasonicCloud.EcoMode,
PanasonicCloud.FanSpeed,
PanasonicCloud.InsideCleaning,
PanasonicCloud.NanoeMode,
PanasonicCloud.OperationMode

* Float<br>
PanasonicCloud.Energy,
PanasonicCloud.Temperature

## 6. Anhang

### GUIDs
- Modul: `{B2C42DAE-0ECA-62EE-9F56-B037A99A2F41}`
- Instanzen:
  - PanasonicCloudIO: `{FA9B3ACC-2056-06B5-4DA6-0C7D375A89FB}`
  - PanasonicCloudConfig: `{85693205-4AF7-C720-B108-05AD5815060D}`
  - PanasonicCloudDevice: `{A972DA17-4989-9CAD-2680-0CB492645050}`
  - PanasonicCloudAquarea: `{7A09A576-A675-F915-B1EC-1135E6700210}`
- Nachrichten:
  - {34871A78-6B14-6BD4-3BE2-192BCB0B150D}: an PanasonicCloudIO
  - {FE8D32D1-6A63-D55B-FC77-8C34A637A5E0}: an PanasonicCloudConfig, PanasonicCloudDevice, PanasonicCloudAquarea

### Quellen

## 7. Versions-Historie

- 1.20 @ 06.05.2024 12:15
  - Neu: Aquarea-Wärmepunpen werden nun unterstützt
  - Fix: Variablenprofil "PanasonicCloud.Temperature" hatte keine Einheit
  - update submodule CommonStubs

- 1.19 @ 07.02.2024 17:52
  - Fix: Absicherung von Zugriffen auf andere Instanzen in Konfiguratoren

- 1.18 @ 29.01.2024 10:50
  - Änderung: Medien-Objekte haben zur eindeutigen Identifizierung jetzt ebenfalls ein Ident
  - update submodule CommonStubs

- 1.17 @ 15.01.2024 17:15
  - Fix: Änderungen in der API der Panasonic Comfort Cloud nachgeführt
  - Neu: Schalter, um Daten zu API-Aufrufen zu sammeln
    Die API-Aufruf-Daten stehen nun in einem Medienobjekt zur Verfügung
  - submodule CommonStubs überarbeitet (Funktionsbereich "ApiCall*", nicht mehr in einem Attribute sondern in einem Medienobjekt)

- 1.16 @ 10.12.2023 11:20
  - Neu: ab IPS-Version 7 ist im Konfigurator die Angabe einer Import-Kategorie integriert, daher entfällt die bisher vorhandene separate Einstellmöglichkeit

- 1.15 @ 05.12.2023 15:32
  - Fix: Wiederanlauf nach HTTP-Fehler verbessert
  - Fix: missverständliche Ausgaben korrigiert

- 1.14.1 @ 29.11.2023 18:25
  - Fix: Schreibfehler korrigiert
  - update submodule CommonStubs

- 1.14 @ 23.10.2023 14:53
  - Neu: Schalter 'Kombiniere Modus "Lüften" mit nanoe' hinzugefügt, um das Verhalten getrennt steuern zu können
  - Neu: Zieltemperatur für jede Betriebsart getrennt merken
  - Fix: Wartezeit bis zum Refresh nach einer Aktion nun getrennt nach lang/kurz einstellbar

- 1.13 @ 15.10.2023 13:51
  - Fix: Änderungen in der API der Panasonic Comfort Cloud nachgeführt
  - Neu: Ermittlung von Speicherbedarf und Laufzeit (aktuell und für 31 Tage) und Anzeige im Panel "Information"
  - Fix: die Statistik der ApiCalls wird nicht mehr nach uri sondern nur noch host+cmd differenziert
  - update submodule CommonStubs

- 1.12 @ 05.07.2023 11:56
  - Fix: Spaltenbreiten im Konfigurator optimiert
  - Neu: Schalter, um die Meldung eines inaktiven Gateway zu steuern
  - Vorbereitung auf IPS 7 / PHP 8.2
  - update submodule CommonStubs
    - Absicherung bei Zugriff auf Objekte und Inhalte

- 1.11 @ 18.01.2023 09:35
  - Neu: Änderung in der Panasonic-Cloud-API nachgezogen, Login war nicht mehr möglich
  - Fix: Absicherung von "Zugriff testen" gegen fehlgeschlagenen Abruf

- 1.10.2 @ 11.01.2023 15:44
  - Fix: Handling des Datencache abgesichert
  - update submodule CommonStubs

- 1.10.1 @ 21.12.2022 09:38
  - Verbesserung: Text zum Datencache verbessert und unter dem Konfigurator positioniert
  - update submodule CommonStubs

- 1.10 @ 29.11.2022 18:23
  - Neu: Führen einer Statistik der API-Calls im IO-Modul, Anzeige als Popup im Experten-Bereich
  - Neu: Verwendung der Option 'discoveryInterval' im Konfigurator (ab 6.3) zur Reduzierung der API-Calls: nur noch ein Discovery/Tag
  - Neu: Daten-Cache für Daten im Konfigurator zur Reduzierung der API-Aufrufe, wird automatisch 1/Tag oder manuell aktualisiert
  - update submodule CommonStubs

- 1.9 @ 24.11.2022 09:02
  - Überarbeitung Nanoe-X-Funktionalität durch @phe
  - update submodule CommonStubs

- 1.8.1 @ 12.10.2022 14:44
  - Konfigurator betrachtet nun nur noch Geräte, die entweder noch nicht angelegt wurden oder mit dem gleichen I/O verbunden sind
  - update submodule CommonStubs

- 1.8 @ 11.10.2022 08:15
  - Änderung in der Panasonic-Cloud-API nachgezogen, Login war nicht mehr möglich
  - update submodule CommonStubs
    Fix: Fehler in SetVariableLogging()

- 1.7.5 @ 07.10.2022 13:59
  - update submodule CommonStubs
    Fix: Update-Prüfung wieder funktionsfähig

- 1.7.4 @ 19.08.2022 16:48
  - Fehlerhafter Text im README korrigiert

- 1.7.3 @ 15.08.2022 13:11
  - Fix: Absicherung des Zugriffs auf ein Datenfeld
  - update submodule CommonStubs
    Fix: in den Konfiguratoren war es nicht möglich, eine Instanz direkt unter dem Wurzelverzeichnis "IP-Symcon" zu erzeugen

- 1.7.2 @ 04.08.2022 10:44
  - Fix: Variablenaktionen "OperateMode", "EcoMode" und "NanoeMode" korrigiert
    Folgefehler aus Version 1.7 (Auswertung Energiedaten)

- 1.7.1 @ 27.07.2022 09:57
  - Fix: Variablenprofil "PanasonicCloud.EcoMode" und "PanasonicCloud.Temperature" korrigiert
  - Fix: Variablenaktion "EcoMode" hat nicht korrekt funktioniert
  - Fix: Variable 'letzte Änderung' entfällt

- 1.7 @ 26.07.2022 10:46
  - Neu: optionale Protokollierung des Energieverbrauchs
  - Neu: Anzeige der letzten Synchronisation des Gerätes mit der Panasonic-Comfort-Cloud

- 1.6.4 @ 25.07.2022 08:39
  - Protokollierung der Timer-Aktivitäten (1.6.3) ist nicht mehr erforderlich, daher wieder entfernt
  - Fix: Soll-Temperatur als float (1.4.1) war nur unvollständig umgesetzt

- 1.6.3 @ 22.07.2022 09:06
  - mehr Debug: LogMessages dazu, um zu ergründen, warum der Timer initial nicht gesetzt ist

- 1.6.2 @ 18.07.2022 14:54
  - Fix: bei IPS-Neustart wurde der Aktualisierungs-Timer nicht gesetzt

- 1.6.1 @ 16.07.2022 15:13
  - Neu: Variable 'AirflowDirection' existiert nicht mehr, Automatic-Modus wird über die Variablen 'AirflowVertical' und/oder 'AirflowHorizontal' eingestellt

- 1.6 @ 16.07.2022 10:06
  - Fix: Ersatz der Variable 'AirflowDirection' durch 'AirflowAutoMode'

- 1.5 @ 15.07.2022 11:54
  - Fix: Änderung der ComfortCloud-API nachgeführt
  - Neu: Funktion "Token löschen" hinzugefügt

- 1.4.2 @ 12.07.2022 17:48
  - Fix: Property "airflow_swing" (Luftstromrichtungswechsel) wurde nicht gesetzt

- 1.4.1 @ 09.07.2022 15:03
  - Fix: Übernahme der Soll-Temperatur als float

- 1.4 @ 09.07.2022 09:51
  - Fix: "Zeitpunkt der letzen Änderung" korrigiert (wird als Millisekunden geliefert)

- 1.3 @ 05.07.2022 15:36
  - Verbesserung: IPS-Status wird nur noch gesetzt, wenn er sich ändert

- 1.2 @ 22.06.2022 10:22
  - Fix: Angabe der Kompatibilität auf 6.2 korrigiert
  - Fix: unbekannter Timer in 'PanasonicCloudConfig'

- 1.1 @ 28.05.2022 12:15
  - update submodule CommonStubs
    Fix: Ausgabe des nächsten Timer-Zeitpunkts
  - einige Funktionen (GetFormElements, GetFormActions) waren fehlerhafterweise "protected" und nicht "private"
  - interne Funktionen sind nun entweder private oder nur noch via IPS_RequestAction() erreichbar

- 1.0.1 @ 17.05.2022 15:38
  - update submodule CommonStubs
    Fix: Absicherung gegen fehlende Objekte

- 1.0 @ 16.05.2022 11:26
  - Initiale Version
